<h2 class="title">Mis Reservas</h2>

<!-- Filtro de estado -->
<mat-form-field appearance="fill" class="filter-select">
  <mat-label>Mostrar</mat-label>
  <mat-select [(ngModel)]="filter" (selectionChange)="onFilterChange($event.value)">
    <mat-option value="all">Todas</mat-option>
    <mat-option value="active">Activas</mat-option>
    <mat-option value="done">Realizadas</mat-option>
  </mat-select>
</mat-form-field>

<!-- Tabla de reservas -->
<mat-card class="table-card">
  <table mat-table [dataSource]="filteredReserves" class="mat-elevation-z2 custom-table">

    <!-- Vehículo -->
    <ng-container matColumnDef="vehicle">
      <th mat-header-cell *matHeaderCellDef> Vehículo </th>
      <td mat-cell *matCellDef="let r"> {{ getVehicleName(r.idVehicle) }} </td>
    </ng-container>

    <!-- Agencia -->
    <ng-container matColumnDef="agency">
      <th mat-header-cell *matHeaderCellDef> Agencia </th>
      <td mat-cell *matCellDef="let r"> {{ getAgencyName(r.idAgencyPickup) }} </td>
    </ng-container>

    <!-- Fecha inicio -->
    <ng-container matColumnDef="pickupDate">
      <th mat-header-cell *matHeaderCellDef> Inicio </th>
      <td mat-cell *matCellDef="let r"> {{ r.pickupDate | date:'yyyy-MM-dd' }} </td>
    </ng-container>

    <!-- Fecha fin -->
    <ng-container matColumnDef="dropoffDate">
      <th mat-header-cell *matHeaderCellDef> Fin </th>
      <td mat-cell *matCellDef="let r"> {{ r.dropoffDate | date:'yyyy-MM-dd' }} </td>
    </ng-container>

    <!-- Precio -->
    <ng-container matColumnDef="price">
      <th mat-header-cell *matHeaderCellDef> Precio </th>
      <td mat-cell *matCellDef="let r"> {{ r.price | currency:'USD':'symbol':'1.2-2' }} </td>
    </ng-container>

    <!-- Estado -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef> Estado </th>
      <td mat-cell *matCellDef="let r"> {{ getStatusLabel(r) }} </td>
    </ng-container>

    <!-- Acciones -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef> Acciones </th>
      <td mat-cell *matCellDef="let r">
          <div class="action-buttons">
        <app-button *ngIf="canModify(r)" [name]="'Editar'" [type]="'button'" (clicked)="editReserve(r.id!)"></app-button>
        <app-button *ngIf="canModify(r)" [name]="'Eliminar'" [type]="'button'" (clicked)="deleteReserve(r.id!, r.idVehicle)"></app-button>
        </div>
      </td>
    </ng-container>

    <!-- Renderizado -->
    <tr mat-header-row *matHeaderRowDef="['vehicle', 'agency', 'pickupDate', 'dropoffDate', 'price', 'status', 'actions']"></tr>
    <tr mat-row *matRowDef="let row; columns: ['vehicle', 'agency', 'pickupDate', 'dropoffDate', 'price', 'status', 'actions'];"></tr>
  </table>
</mat-card>

<!-- Botón para nueva reserva -->
<div class="btn-new">
  <app-button
    [name]="'Nueva Reserva'"
    [type]="'button'"
    (clicked)="goToRegister()">
  </app-button>
</div>
